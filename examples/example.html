<html>
  <div>
    <input
      type="range"
      id="resolution"
      name="resolution"
      min="10"
      max="100"
      value="50"
    />
    <label for="resolution" id="labelsize">Resolution (50)</label>
  </div>
  <div id="map"></div>

  <script type="module">
    import * as geoviz from "https://cdn.jsdelivr.net/npm/geoviz@0.8.2/+esm";
    import { json } from "https://cdn.jsdelivr.net/npm/d3-fetch@3/+esm";
    import * as geogrid from "https://cdn.jsdelivr.net/npm/geogrid@0.0.5/+esm";

    async function main() {
      const world = await json("./world.json");
      const cities = await json("./cities.json");

      let svg = geoviz.create({
        domain: world,
        projection: "NaturalEarth1",
        zoomable: true,
        width: 1000,
      });

      let dots = geogrid.project(cities, { projection: svg.projection });

      const slider = document.getElementById("resolution");

      function drawGrid(step) {
        let g = geogrid.hexbin({
          step: step,
          overflow: true,
          width: svg.width,
          height: svg.height,
        });

        const test = geogrid.pointstogrid({
          points: dots,
          grid: g,
          var: "population",
        });

        svg.plot({
          id: "mygrid",
          type: "choro",
          data: test,
          var: "count",
          coords: "svg",
          tip: true,
          opacity: 0.8,
          legend: false,
        });
      }

      svg.path({ datum: world, fill: "#CCC" });
      drawGrid(parseInt(slider.value));
      svg.circle({
        data: cities,
        stroke: "#000",
        strokeWidth: 0.3,
        fill: "red",
        r: 1.5,
      });

      // Interactivit√©
      slider.addEventListener("input", function () {
        document.getElementById(
          "labelsize"
        ).innerHTML = `Resolution (${slider.value})`;
        drawGrid(parseInt(slider.value));
      });

      document.querySelector("#map").append(svg.render());
    }

    main();
  </script>
</html>
